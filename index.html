<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Contacto</title>
  <link rel="stylesheet" href="css/App.css">
  <link rel="stylesheet" href="css/Contacto.css">
  <link rel="stylesheet" href="css/tailwind.css">
  <link rel="stylesheet" href="index.css">

  <style>
    body {
      padding: 0;
      margin: 0;
    }

    @media only screen and (max-width: 600px) {
      .contacto-outer {

        padding: 20px;
      }

    }

    .transition-colors {
      transition-duration: .15s;
      transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
      transition-timing-function: cubic-bezier(.4, 0, .2, 1);
    }

    .ring-offset-background {
      --tw-ring-offset-color: hsl(var(--background));
    }

    .text-primary-foreground {
      color: hsl(var(--primary-foreground));
    }

    .font-semibold {
      font-weight: 600;
    }

    .text-sm {
      font-size: .875rem;
      line-height: 1.25rem;
    }

    .px-8 {
      padding-left: 2rem;
      padding-right: 2rem;
    }

    .rounded-md {
      border-radius: calc(var(--radius) - 2px);
    }

    .whitespace-nowrap {
      white-space: nowrap;
    }

    .justify-center {
      justify-content: center;
    }

    .items-center {
      align-items: center;
    }

    .h-11 {
      height: 2.75rem;
    }

    .hover\:bg-primary\/70:hover {
      background-color: hsl(var(--primary) / .7);
    }

    [role=button],
    button {
      cursor: pointer;
    }

    input[type=checkbox] {
      /* Double-sized Checkboxes */
      -ms-transform: scale(2);
      /* IE */
      -moz-transform: scale(2);
      /* FF */
      -webkit-transform: scale(2);
      /* Safari and Chrome */
      -o-transform: scale(2);
      /* Opera */
      transform: scale(2);
      padding: 10px;
      margin-left: 10px;
    }

    /* Might want to wrap a span around your checkbox text */
    .checkboxtext {
      /* Checkbox text */
      font-size: 110%;
      display: inline;
    }

    @media (min-width: 768px) {
      .md\:w-fit {
        width: -webkit-fit-content;
        width: -moz-fit-content;
        width: fit-content;
      }
    }

    h3 {
      font-family: Viga;
      font-size: 1.875rem !important;
      font-weight: 400;

    }

    @media (min-width: 1024px) {
      h3 {
        font-size: 3rem !important;
        line-height: 1 !important;
      }
    }

    .text-primary {
      color: hsl(var(--primary));
    }

    .bg-primary {
      background-color: hsl(var(--primary));
      border: none;
    }

    .head-logo {
      display: flex;
      padding-top: 2rem;
    }

    div a img.logo {
      max-width: 250px;
    }

    .container-fluid.footer {
      display: flex;
      justify-content: center;
      text-align: center;
      background: #f1f1f1;
      padding: 2rem 0;
      font-size: 1.2rem;
      color: var(--main-grey);
    }

    /* contact form validation */

    /* **********     ContactForm Validations     ********** */

    /* **********     ContactForm Validations     ********** */
    .contact-form {
      --form-ok-color: #4caf50;
      /* --form-error-color: #f44336; */
      margin-left: auto;
      margin-right: auto;
      width: 80%;
    }

    .contact-form>* {
      padding: 0.5rem;
      margin: 1rem auto;
      display: block;
      /* width: 100%; */
    }

    .contact-form textarea {
      resize: none;
    }

    .contact-form legend,
    .contact-form-response {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
    }

    .contact-form input,
    .contact-form textarea {
      font-size: 1rem;
      font-family: sans-serif;
    }

    .contact-form input[type="submit"] {
      width: 50%;
      font-weight: bold;
      cursor: pointer;
    }

    .contact-form *::placeholder {
      color: #000;
    }

    .contact-form [required]:valid {
      border: thin solid var(--form-ok-color);
    }

    .contact-form [required]:invalid {
      border: thin solid var(--form-error-color);
    }

    .contact-form-error {
      margin-top: 1px;
      font-size: 100%;
      color: #cc0f19;
      transition: all 800ms ease;
    }

    .contact-form-error.is-active {
      display: block;
      animation: show-message 1s 1 normal 0s ease-out both;
    }

    .none {
      display: none;
    }

    button:disabled {
      opacity: 0.5;
      /* Reduce la opacidad del botón cuando está deshabilitado */
      cursor: not-allowed;
      /* Cambia el cursor a 'no permitido' */
      /* Puedes añadir estilos adicionales según tus necesidades */
    }

    @keyframes show-message {
      0% {
        visibility: hidden;
        opacity: 0;
      }

      100% {
        visibility: visible;
        opacity: 1;
      }
    }

    .alert-success {
      color: #0f5132;
      background-color: #d1e7dd;
      border-color: #badbcc
    }

    .alert {
      position: relative;
      padding: 1rem 1rem;
      margin-bottom: 1rem;
      border: 1px solid transparent;
      border-radius: .25rem
    }

    .alert-danger {
      color: #842029;
      background-color: #f8d7da;
      border-color: #f5c2c7
    }

    .w-full {
      width: 100%;
    }

    button#enviar {
      letter-spacing: 2px;
    }
  </style>

</head>

<body>
  <div class="head-logo" style="margin: auto;">
    <a style="margin: auto;" href="https://javer.com.mx"><img style="margin: auto;" src="img/bar-logo.png" alt="logo"
        class="w-28 lg:w-44 logo"></a>
  </div>

  <form id="form1" class="contacto-outer contact-form " action="https://backend-buzon.onrender.com/enviar-correo"
    method="POST">

    <div class="contacto-form">
      <h3 style="margin: 2rem auto 20px auto; font-family: 'Viga', sans-serif; font-weight: 100;"
        class="main-title-eti py-5 pb-4 text-primary">Comentarios y sugerencias</h3>

      <div class="my-8">
        <h4 style="font-size: 1.5rem; margin-top: 20px;" class="text-center ">Su opinión es importante para nosotros
        </h4>
        <p class="text-neutral-400 text-center mt-6 uppercase"> En Javer, nos comprometemos a ofrecer a nuestros
          clientes la
          mejor experiencia posible. Por eso, valoramos mucho su opinión.</p>
      </div>
      <hr style="margin: 2rem 0;">

      <div id="form-message-1" style=" margin-bottom: 1em;"></div>
      <div class="contacto-row">
        <div class="contacto-input-col"><label>Nombre Completo:</label>

          <input type="text" name="nombre" title="Nombre sólo acepta letras y espacios en blanco"
            pattern="[A-Za-zÁáÉéÍíÓóÚúÜüÑñ\s]{2,80}" required>

        </div>
        <div class="contacto-input-col"><label>Teléfono:</label>
          <input type="tel" name="telefono" title="Teléfono debe tener entre 8 y 10 dígitos" pattern="[0-9]{8,10}"
            required>

        </div>
      </div>
      <div class="contacto-row">

        <div class="contacto-input-col"><label>Correo Electrónico:</label>
          <input type="email" name="email" title="El email no es válido"
            pattern="^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$" required>




        </div>
        <div class="contacto-input-col"><label>Desarrollo que visitas:</label>

          <input type="text" name="desarrollo" title="El desarrollo sólo acepta letras y espacios en blanco"
            pattern="[A-Za-zÁáÉéÍíÓóÚúÜüÑñ\s]{2,80}" required>

        </div>
      </div>

      <div class="contacto-row">
        <div class="contacto-input-col"><label>Sugerencia/recomendación:</label>
          <textarea name="mensaje" title="Tu sugerencia no debe ser mayor de 500 caracteres" required></textarea>
        </div>
      </div>


      <div class="contacto-row cor2">

        <input type="checkbox" id="terminos" required name="aviso" required="">
        <div style="cursor: pointer;">Acepto las políticas <a style="padding-left: 5px;"
            href="https://www.javer.com.mx/avisos-de-privacidad"> Políticas de privacidad</a></div>
      </div>

      <div style="margin: 10px 0;" id="recaptcha_container"></div>

      <div class="col-span-1 sm:col-span-2">
        <button id="enviar" disabled
          class="inline-flex items-center justify-center whitespace-nowrap text-sm font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/70 h-11 rounded-md px-8 w-full md:w-fit"
          type="submit">ENVIAR MI SUGERENCIA / RECOMENDACIÓN </button>
      </div>
      <div class="contact-form-loader none">
        <img src="assets/" alt="Cargando">
      </div>
      <div class="contact-form-response none">
        <p>Los datos han sido enviados</p>
      </div>

    </div>

  </form>

  <div class="container-fluid footer px-0 pb-5 bg-secondary px-4">
    <div class=" py-0 row">
      <div class="d-flex justify-content-center border-top">
        <p class="fw-bolder mt-5 text-center text-black-50">
          ¡Agradecemos su tiempo y su opinión!
          <br>
          Estamos comprometidos a mejorar continuamente, y sus
          comentarios nos ayudan a lograrlo.
        </p>
      </div>
    </div>
  </div>
  <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
  <script>
    let recaptchaWidgetId;

    function onloadCallback() {
      const container = document.getElementById('recaptcha_container');
      recaptchaWidgetId = grecaptcha.render(container, {
        sitekey: '6LdxGWwrAAAAAP3bxmkm37nNQjDnFnSqAjzJ2hQr',
        callback: function (token) {
          // Ya no es necesario llenar g-recaptcha-response en un input oculto si enviamos JSON directo
          document.getElementById('enviar').disabled = false;
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('form1');
      const messageDiv = document.getElementById('form-message-1');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        messageDiv.textContent = '';
        messageDiv.className = '';

        // Recopilamos los datos directamente desde el formulario
        const nombre = form.nombre.value.trim();
        const telefono = form.telefono.value.trim();
        const email = form.email.value.trim();
        const desarrollo = form.desarrollo.value.trim();
        const mensaje = form.mensaje.value.trim();
        const acepto = form.aviso.checked;
        const recaptchaToken = grecaptcha.getResponse(recaptchaWidgetId);

        // Validaciones
        const nameRegex = /^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]{4,}$/;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const phoneRegex = /^[0-9]{8,10}$/;

        if (!nameRegex.test(nombre)) {
          showError('Nombre inválido. Usa solo letras y al menos 4 caracteres.');
          return;
        }

        if (!emailRegex.test(email)) {
          showError('Correo electrónico no válido.');
          return;
        }

        if (!phoneRegex.test(telefono)) {
          showError('Teléfono no válido (8-10 dígitos numéricos).');
          return;
        }

        if (!desarrollo || !mensaje) {
          showError('Todos los campos son obligatorios.');
          return;
        }

        if (!acepto) {
          showError('Debes aceptar las políticas de privacidad.');
          return;
        }

        if (!recaptchaToken) {
          showError('Por favor, completa el reCAPTCHA.');
          return;
        }

        try {
          // Enviar datos como JSON
          const response = await fetch(form.action, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              nombre,
              telefono,
              email,
              desarrollo,
              mensaje,
              aviso: acepto,
              "g-recaptcha-response": recaptchaToken,
            }),
          });

          const result = await response.json();

          if (!response.ok) {
            showError(result.message || 'Error al enviar el formulario.');
            return;
          }

          messageDiv.classList.add('alert', 'alert-success');
          messageDiv.textContent = '✅ Formulario enviado correctamente.';
          messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
          form.reset();
          grecaptcha.reset(recaptchaWidgetId);
          document.getElementById('enviar').disabled = true;
        } catch (error) {
          console.error(error);
          showError('Error de red o del servidor.');
        }

        function showError(msg) {
          messageDiv.classList.add('alert', 'alert-danger');
          messageDiv.textContent = '❌ ' + msg;
          messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });
    });

  </script>

</body>

</html>